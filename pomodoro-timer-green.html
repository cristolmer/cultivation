<script>
  let timer;
  let running = false;
  let targetTime = null;

  function updateDisplay() {
    if (!targetTime) return;

    const now = Date.now();
    const remaining = Math.max(0, targetTime - now);
    const mins = Math.floor(remaining / 60000);
    const secs = Math.floor((remaining % 60000) / 1000);

    document.getElementById('timer').textContent =
      `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

    if (remaining <= 0) {
      clearInterval(timer);
      running = false;
      document.getElementById('alarmSound').play();
      alert("Time's up! Take a break 🍵");
    }
  }

  function startTimer() {
    if (!running) {
      const duration = parseInt(document.getElementById('duration').value) * 60000;
      targetTime = Date.now() + duration;
      timer = setInterval(updateDisplay, 1000);
      running = true;
    }
  }

  function pauseTimer() {
    clearInterval(timer);
    running = false;
    const currentDisplay = document.getElementById('timer').textContent.split(':');
    const mins = parseInt(currentDisplay[0]);
    const secs = parseInt(currentDisplay[1]);
    targetTime = Date.now() + (mins * 60000) + (secs * 1000);
  }

  function resetTimer() {
    clearInterval(timer);
    running = false;
    const selectedDuration = parseInt(document.getElementById('duration').value);
    targetTime = null;
    document.getElementById('timer').textContent = `${selectedDuration}:00`;
  }

  function changeDuration() {
    resetTimer();
  }

  updateDisplay();
</script>
